var __bind=function(t,n){return function(){return t.apply(n,arguments)}};define(["jquery"],function(t){return function(n){var e;return e=function(){function e(e,i){t.prev=__bind(t.prev,this),t.next=__bind(t.next,this),t.closeOnKeyDown=__bind(t.closeOnKeyDown,this),t.changePageOnKeyDown=__bind(t.changePageOnKeyDown,this),t.showPanelAtIndex=__bind(t.showPanelAtIndex,this),t.showPanel=__bind(t.showPanel,this),t.updateCounter=__bind(t.updateCounter,this),t.end=__bind(t.end,this),t.start=__bind(t.start,this);var o;o={interactive:!1,arrows:{weight:1,color:"white",distance:80},backdrop:!0,closable:!0,annotationPadding:10,counter:!0},this.tutorial=e,this.options=n.extend(!0,o,i),this.currentIndex=-1,this.container=null,this.backdrop=null,this.canvas=null,this.counter=null}return e.prototype.start=function(){return this.options.backdrop&&(this.backdrop=n("<div/>",{"class":"tutorial-backdrop",css:{background:"rgba(0, 0, 0, 0.8)"}}).appendTo(n("body"))),this.container=n("<div/>",{"class":"tutorial-container"}).appendTo(n("body")),this.options.counter&&(this.counter=n("<div/>",{"class":"tutorial-panel-counter"}).appendTo(this.container)),this.options.interactive&&(this.container.click(this.next),n(document).keydown(this.changePageOnKeyDown)),this.options.closable&&!this.options.interactive&&this.container.click(this.end),this.options.closable&&(this.container.append(n("<a/>",{"class":"tutorial-close",html:"&#10006;"}).click(this.end)),n(document).keydown(this.closeOnKeyDown)),this.canvas=n("<canvas/>",{"class":"tutorial-canvas"}).appendTo(this.container).attr("width",this.container.width()).attr("height",this.container.height())[0],this.showPanelAtIndex(0)},e.prototype.end=function(){var t;return this.container.off("click",this.next),n(document).off("keydown",this.changePageOnKeyDown),n(document).off("keydown",this.closeOnKeyDown),this.container.remove(),null!=(t=this.backdrop)&&t.remove(),n(this.canvas).remove(),n("body").find(".tutorial-show-element").removeClass("tutorial-show-element"),this.currentIndex=-1,this.container=null,this.canvas=null},e.prototype.updateCounter=function(){var t;return null!=(t=this.counter)?t.text(""+(this.currentIndex+1)+" / "+this.tutorial.length):void 0},e.prototype.showPanel=function(t){var e,i,o,s,a,r,h,c,d,l,u,p,w,v,g,f,b;for(this.container.find(".tutorial-message, .tutorial-annotation").remove(),n("body").find(".tutorial-show-element").removeClass("tutorial-show-element"),this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),b=[],v=0,g=t.length;g>v;v++){switch(e=t[v],i=n("<div/>",{"class":"tutorial-annotation"}).append(n("<p/>",{"class":"tutorial-annotation-text",html:e.text})).appendTo(this.container),w=n(e.selector),w.addClass("tutorial-show-element"),n.type("object"===e.arrow)?(r={},n.extend(r,this.options.arrows,e.arrow)):r=this.options.arrows,o=null!=(f=e.padding)?f:this.options.annotationPadding,p=w.offset(),e.position){case"top":s=p.left+w.width()/2-i.width()/2,a=p.top-r.distance,h=s+i.width()/2,d=a+i.height()+o;break;case"bottom":s=p.left+w.width()/2-i.width()/2,a=p.top+w.height()+r.distance,h=s+i.width()/2,d=a-o;break;case"left":s=p.left-r.distance,a=p.top+w.height()/2-i.height()/2,h=s+i.width()+o,d=a+i.height()/2;break;case"right":s=p.left+w.width()+r.distance,a=p.top+w.height()/2-i.height()/2,h=s-o,d=a+i.height()/2}i.css("left",s),i.css("top",a),e.arrow?(u=this.canvas.getContext("2d"),u.save(),u.strokeStyle=r.color,u.lineWidth=r.weight,u.beginPath(),u.moveTo(h,d),c=p.left+w.width()/2,l=p.top+w.height()/2,u.lineTo(c,l),u.stroke(),u.closePath(),b.push(u.restore())):b.push(void 0)}return b},e.prototype.showPanelAtIndex=function(t){return this.currentIndex=t,this.showPanel(this.tutorial[t]),this.updateCounter()},e.prototype.changePageOnKeyDown=function(t){switch(t.which){case 37:return this.prev();case 39:return this.next()}},e.prototype.closeOnKeyDown=function(t){return 27===t.which?this.end():void 0},e.prototype.next=function(){var t;return-1<(t=this.currentIndex)&&t<this.tutorial.length-1?this.showPanelAtIndex(this.currentIndex+1):this.end()},e.prototype.prev=function(){var t;return this.tutorial.length>(t=this.currentIndex)&&t>0?this.showPanelAtIndex(this.currentIndex-1):void 0},e}()}}(this));