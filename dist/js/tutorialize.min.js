(function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};t=function(){function t(t,n){this.prev=e(this.prev,this),this.next=e(this.next,this),this.closeOnKeyDown=e(this.closeOnKeyDown,this),this.changePageOnKeyDown=e(this.changePageOnKeyDown,this),this.showPanelAtIndex=e(this.showPanelAtIndex,this),this.showPanel=e(this.showPanel,this),this.updateCounter=e(this.updateCounter,this),this.end=e(this.end,this),this.start=e(this.start,this);var i;i={interactive:!1,arrows:{weight:1,color:"white",distance:80},backdrop:!0,closable:!0,annotationPadding:10,counter:!0},this.tutorial=t,this.options=$.extend(!0,i,n),this.currentIndex=-1,this.container=null,this.backdrop=null,this.canvas=null,this.counter=null}return t.prototype.start=function(){return this.options.backdrop&&(this.backdrop=$("<div/>",{"class":"tutorial-backdrop",css:{background:"rgba(0, 0, 0, 0.8)"}}).appendTo($("body"))),this.container=$("<div/>",{"class":"tutorial-container"}).appendTo($("body")),this.options.counter&&(this.counter=$("<div/>",{"class":"tutorial-panel-counter"}).appendTo(this.container)),this.options.interactive&&(this.container.click(this.next),$(document).keydown(this.changePageOnKeyDown)),this.options.closable&&!this.options.interactive&&this.container.click(this.end),this.options.closable&&(this.container.append($("<a/>",{"class":"tutorial-close",html:"&#10006;"}).click(this.end)),$(document).keydown(this.closeOnKeyDown)),this.canvas=$("<canvas/>",{"class":"tutorial-canvas"}).appendTo(this.container).attr("width",this.container.width()).attr("height",this.container.height())[0],this.showPanelAtIndex(0)},t.prototype.end=function(){var t;return this.container.off("click",this.next),$(document).off("keydown",this.changePageOnKeyDown),$(document).off("keydown",this.closeOnKeyDown),this.container.remove(),null!=(t=this.backdrop)&&t.remove(),$(this.canvas).remove(),$("body").find(".tutorial-show-element").removeClass("tutorial-show-element"),this.currentIndex=-1,this.container=null,this.canvas=null},t.prototype.updateCounter=function(){var t;return null!=(t=this.counter)?t.text(""+(this.currentIndex+1)+" / "+this.tutorial.length):void 0},t.prototype.showPanel=function(t){var e,n,i,o,s,h,a,r,c,l,u,d,p,w,v,g,f;for(this.container.find(".tutorial-message, .tutorial-annotation").remove(),$("body").find(".tutorial-show-element").removeClass("tutorial-show-element"),this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),f=[],w=0,v=t.length;v>w;w++){switch(e=t[w],n=$("<div/>",{"class":"tutorial-annotation"}).append($("<p/>",{"class":"tutorial-annotation-text",html:e.text})).appendTo(this.container),p=$(e.selector),p.addClass("tutorial-show-element"),$.type("object"===e.arrow)?(h={},$.extend(h,this.options.arrows,e.arrow)):h=this.options.arrows,i=null!=(g=e.padding)?g:this.options.annotationPadding,d=p.offset(),e.position){case"top":o=d.left+p.width()/2-n.width()/2,s=d.top-h.distance,a=o+n.width()/2,c=s+n.height()+i;break;case"bottom":o=d.left+p.width()/2-n.width()/2,s=d.top+p.height()+h.distance,a=o+n.width()/2,c=s-i;break;case"left":o=d.left-h.distance,s=d.top+p.height()/2-n.height()/2,a=o+n.width()+i,c=s+n.height()/2;break;case"right":o=d.left+p.width()+h.distance,s=d.top+p.height()/2-n.height()/2,a=o-i,c=s+n.height()/2}n.css("left",o),n.css("top",s),e.arrow?(u=this.canvas.getContext("2d"),u.save(),u.strokeStyle=h.color,u.lineWidth=h.weight,u.beginPath(),u.moveTo(a,c),r=d.left+p.width()/2,l=d.top+p.height()/2,u.lineTo(r,l),u.stroke(),u.closePath(),f.push(u.restore())):f.push(void 0)}return f},t.prototype.showPanelAtIndex=function(t){return this.currentIndex=t,this.showPanel(this.tutorial[t]),this.updateCounter()},t.prototype.changePageOnKeyDown=function(t){switch(t.which){case 37:return this.prev();case 39:return this.next()}},t.prototype.closeOnKeyDown=function(t){return 27===t.which?this.end():void 0},t.prototype.next=function(){var t;return-1<(t=this.currentIndex)&&t<this.tutorial.length-1?this.showPanelAtIndex(this.currentIndex+1):this.end()},t.prototype.prev=function(){var t;return this.tutorial.length>(t=this.currentIndex)&&t>0?this.showPanelAtIndex(this.currentIndex-1):void 0},t}(),function(e){return e.tutorialize=function(e){var n;return null==e&&(e={}),n=e.tutorial,delete e.tutorial,new t(n,e)}}(jQuery)}).call(this);